<!DOCTYPE html>
<html>
  <head>
    <title>Image Metadata Viewer</title>
    <meta charset="utf-8" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <link rel="stylesheet" type="text/css" href="css/sideNavBar.css" />
    <link rel="stylesheet" type="text/css" href="css/topNavBar.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  </head>

  <body style="background-image: url(img/background.png);">
      <!-- LEFT PART -->
      <!-- Side naviagtion bar  -->
      <div class="sideNavBar">
          <!--LOGO-->
          <div id="logo" align="center">
              <img id="logo" src="img/logo.png" />
          </div>
          
          <!-- Buttons section -->
          <div class="container buttonsSideBar" align="center">
              <!--UPLOAD BUTTON-->
              <label class="btn btn-primary btn-responsive uploadButton" for="photos" align="center">Upload JPEG photo</label>
              <input type="file" id="photos" multiple="multiple" id="file-input" onchange="readURL(this);" accept="image/jpeg" display="none"/>

              <div>
                  <h5 style="font-size: 0.8vw">Upload a local file (only JPEG) to read Exif data.</h5>
              </div>
              
              <!-- Filter section -->
              <div>
                  <h4 align="left" style="font-size: 1.2vw">Filter by: </h4>
              </div>
              <div class="row button-row sideGroup">
                  <div class="col-xs button-container sideGroup">
                      <div class="btn-group sideGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> One - 1 </button>
                         <div class="dropdown-menu">
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
                                     <label class="form-check-label" for="inlineCheckbox1">First</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox2" value="option2">
                                     <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox3" value="option3">
                                     <label class="form-check-label" for="inlineCheckbox3">Third</label>
                                 </div>
                             </a>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="row button-row sideGroup">
                  <div class="col-xs button-container sideGroup">
                      <div class="btn-group sideGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> Two - 2 </button>
                         <div class="dropdown-menu">
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
                                     <label class="form-check-label" for="inlineCheckbox1">First</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox2" value="option2">
                                     <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox3" value="option3">
                                     <label class="form-check-label" for="inlineCheckbox3">Third</label>
                                 </div>
                             </a>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="row button-row sideGroup">
                  <div class="col-xs button-container sideGroup">
                      <div class="btn-group sideGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> Three - 3 </button>
                         <div class="dropdown-menu">
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
                                     <label class="form-check-label" for="inlineCheckbox1">First</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox2" value="option2">
                                     <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox3" value="option3">
                                     <label class="form-check-label" for="inlineCheckbox3">Third</label>
                                 </div>
                             </a>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="row button-row sideGroup">
                  <div class="col-xs button-container sideGroup">
                      <div class="btn-group sideGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> Four - 4 </button>
                         <div class="dropdown-menu">
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
                                     <label class="form-check-label" for="inlineCheckbox1">First</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox2" value="option2">
                                     <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox3" value="option3">
                                     <label class="form-check-label" for="inlineCheckbox3">Third</label>
                                 </div>
                             </a>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="row button-row sideGroup">
                  <div class="col-xs button-container sideGroup">
                      <div class="btn-group sideGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> Five - 5 </button>
                         <div class="dropdown-menu">
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
                                     <label class="form-check-label" for="inlineCheckbox1">First</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox2" value="option2">
                                     <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox3" value="option3">
                                     <label class="form-check-label" for="inlineCheckbox3">Third</label>
                                 </div>
                             </a>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="row button-row sideGroup">
                  <div class="col-xs button-container sideGroup">
                      <div class="btn-group sideGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> Six - 6 </button>
                         <div class="dropdown-menu">
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
                                     <label class="form-check-label" for="inlineCheckbox1">First</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox2" value="option2">
                                     <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                 </div>
                             </a>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="row button-row sideGroup">
                  <div class="col-xs button-container sideGroup">
                      <div class="btn-group sideGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> Seven - 7 </button>
                         <div class="dropdown-menu">
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
                                     <label class="form-check-label" for="inlineCheckbox1">First</label>
                                 </div>
                             </a>
                             <a class="dropdown-item">
                                 <div class="form-check form-check-inline">
                                     <input class="form-check-input" type="checkbox" id="inlineCheckbox2" value="option2">
                                     <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                 </div>
                             </a>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="row button-row sideGroup">
                  <div class="col-xs button-container sideGroup">
                      <div class="btn-group sideGroup">
                          <button type="button" class="btn btn-primary btn-responsive filterButton"> Filter </button>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      
      <!--RIGHT PART-->
      <!-- Top navigation bar -->
      <div class="topNavBar">
          <div class="container buttonsTopBar">
              <h4 style="font-size: 1.2vw">Sort by: </h4>
              <div class="row button-row topGroup">
                  <div class="col-xs button-container topGroup">
                      <div class="btn-group topGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> Name </button>
                          <div class="dropdown-menu">
                              <a class="dropdown-item"><span class="glyphicon glyphicon-sort-by-alphabet"></span> A - Z </a>
                              <a class="dropdown-item"><span class="glyphicon glyphicon-sort-by-alphabet-alt"></span> Z -A </a>
                          </div>
                      </div>
                  </div>
                  <div class="col-xs button-container topGroup">
                      <div class="btn-group topGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> Date </button>
                          <div class="dropdown-menu">
                              <a class="dropdown-item">Oldest to Newest</a>
                              <a class="dropdown-item">Newest to Oldest</a>
                          </div>
                      </div>
                  </div>
                  <div class="col-xs button-container topGroup">
                      <div class="btn-group topGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> Camera model </button>
                          <div class="dropdown-menu">
                              <a class="dropdown-item"><span class="glyphicon glyphicon-sort-by-alphabet"></span> A - Z </a>
                              <a class="dropdown-item"><span class="glyphicon glyphicon-sort-by-alphabet-alt"></span> Z -A </a>
                          </div>
                      </div>
                  </div>
                  <div class="col-xs button-container topGroup">
                      <div class="btn-group topGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> One </button>
                            <div class="dropdown-menu">
                              <a class="dropdown-item"> Link 1 </a>
                              <a class="dropdown-item"> Link 2 </a>
                            </div>
                      </div>
                  </div>
                  <div class="col-xs button-container topGroup">
                      <div class="btn-group topGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> Two </button>
                            <div class="dropdown-menu">
                              <a class="dropdown-item"> Link 1 </a>
                              <a class="dropdown-item"> Link 2 </a>
                            </div>
                      </div>
                  </div>
                  <div class="col-xs button-container topGroup">
                      <div class="btn-group topGroup">
                          <button type="button" class="btn btn-primary dropdown-toggle btn-responsive" data-toggle="dropdown"> Three </button>
                            <div class="dropdown-menu">
                              <a class="dropdown-item"> Link 1 </a>
                              <a class="dropdown-item"> Link 2 </a>
                            </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>

    <!---UPLOADING ZONE-->
    <div class="images" id="images"></div>

    <!-- Zoom photo modal -->
    <div id="myModal" class="modal">
      <img class="modal-content" id="img01" />
      <div id="caption"></div>
    </div>

    <!-- Popup modal Detail-->
    <div
      class="modal fade bd-example-modal-lg"
      id="popupModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalCenterTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">Modal title</h5>
          </div> 
          <div class="modal-body">
            <div class="row">
              <div class="col">
                <img class="modal-popup-content" id="imgPopup" />
                <!-- Image miniature above -->
              </div>
              <div class="col">
                <div class="form-group row">
                    <label for="modalDate" class="col-4 col-form-label">Date Taken: </label>
                    <div class="col-8">
                      <input type="text" class="form-control" id="modalDate" placeholder="YYYY/MM/DD">
                    </div>
                </div>
                <div class="form-group row justify-content-md-center">
                    <label for="modalGPS" class="col-4 col-form-label">Latitude: </label>
                    <div class="col">
                        <input type="number" class="form-control form-fixer" id="modalGPS1" placeholder="00">
                        °
                    </div>
                    <div class="col">
                        <input type="number" class="form-control form-fixer" id="modalGPS2" placeholder="00">
                        '
                    </div>
                    <div class="col">
                        <input type="number" class="form-control form-fixer" id="modalGPS3" placeholder="00">
                        "
                    </div>
                    <div class="col">
                        <select class="form-control form-fixer2" id="modalGPS4">
                            <option value=1>N</option>
                            <option value=1>S</option>
                        </select>
                    </div>
                </div>
                <div class="form-group row justify-content-md-center">
                    <label for="modalGPS" class="col-4 col-form-label">Longitude: </label>
                    <div class="col">
                        <input type="number" class="form-control form-fixer" id="modalGPS1" placeholder="00">
                        °
                    </div>
                    <div class="col">
                        <input type="number" class="form-control form-fixer" id="modalGPS2" placeholder="00">
                        '
                    </div>
                    <div class="col">
                        <input type="number" class="form-control form-fixer" id="modalGPS3" placeholder="00">
                        "
                    </div>
                    <div class="col">
                        <select class="form-control form-fixer2" id="modalGPS4">
                            <option value=1>E</option>
                            <option value=1>W</option>
                        </select>
                    </div>
                </div>
                <div class="form-group row justify-content-md-center">
                    <label for="modalModel" class="col-4 col-form-label">Model and device: </label>
                    <div class="col-4">
                        <input type="text" class="form-control" id="modalModel" placeholder="Model">
                    </div>
                    <div class="col-4">
                      <input type="text" class="form-control" id="modalDevice" placeholder="Device">
                    </div>
                </div>
                <div class="form-group row justify-content-md-center">
                    <label for="modalIso" class="col-4 col-form-label">ISO Speed Ratings: </label>
                    <div class="col-8">
                      <input type="number" class="form-control" id="modalIso" placeholder="0">
                    </div>
                </div>
                <div class="form-group row justify-content-md-center">
                    <label for="modalExposure" class="col-4 col-form-label">Exposure Time: </label>
                    <div class="col-8">
                      <input type="text" class="form-control" id="modalExposure" placeholder="10">
                    </div>
                </div>
                <div class="form-group row justify-content-md-center">
                    <label for="modalExposure" class="col-4 col-form-label">Flash: </label>
                    <div class="col-4">
                        <select class="custom-select mr-sm-2" id="modalFleshType">
                            <!-- <option selected>Choose...</option> -->
                            <option value="1">Auto</option>
                            <option value="2">Copumlsory Flash Firing</option>
                            <option value="3">Compulsory Flash Suppression</option>
                        </select>
                    </div>
                    <div class="col-4">
                        <select class="custom-select mr-sm-2" id="modalFleshFired">
                            <option value="1">Flash fired</option>
                            <option value="2">Flash didn't fired</option>
                        </select>
                    </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <!--End of modal-->
    <script src="piexif.js"></script>
    <script>
      var arrImages = [];
      /* global variable storing exif data of every image */
      var arrEXIF = [];
      var imgID = 0;
      function readURL(input) {
        for (let i = 0; i < input.files.length; i++) {
          arrImages.push(input.files[i]);
          var reader = new FileReader();
          reader.onload = function(event) {
            var exifObj = piexif.load(event.target.result);
            arrEXIF.push(exifObj);

            /* EXAMPLE - wartości można zobaczyc w konsoli Fn + F12*/
            console.log(exifObj["0th"]["306"]) // tak się czyta na przykład datę wykonania
            console.log(arrEXIF[0]["0th"]["306"]) // a tak ze zmiennej globalnej
            console.log(piexif.TAGS["0th"]["306"]["name"]) 
            console.log(exifObj) // tutaj można podejrzeć jakie są numerki
            for (var ifd in exifObj) { // Loop through the properties of an object
              if (ifd == "thumbnail") {
                continue; // ommit "thumbnail"
              }
              console.log("-" + ifd);
              for (var tag in exifObj[ifd]) {
                // a tu można podejrzeć co oznaczają dane numerki - jakie mają nazwy, np. DateTime to 306
                console.log("  " + piexif.TAGS[ifd][tag]["name"] + ":" + exifObj[ifd][tag] + " ifd:" + ifd + " tag:" + tag);
              }
            }

            var newDiv = document.createElement("div");
            newDiv.className = "dropdown";

            var img = document.createElement("img"); // create new image
            img.src = event.target.result; // source = uploaded file
            imgID++;
            img.setAttribute("id", "photo_" + imgID);
            img.addEventListener("click", function() {
              displayModal(img.id, img);
            });
            newDiv.appendChild(img);

            var newList = document.createElement("ul"); // dropdown list
            newList.className = "dropdown-content";

            var button1 = document.createElement("li");
            var a1 = document.createElement("a");
            a1.type = "button";
            a1.textContent = "View Photo";
            a1.setAttribute("id", imgID);
            a1.addEventListener("click", function() {
              displayModal(img.id, a1);
            });
            button1.appendChild(a1);
            newList.appendChild(button1);

            var button2 = document.createElement("li");
            var a2 = document.createElement("a");
            a2.type = "button";
            a2.textContent = "Rename?";
            a2.setAttribute("id", imgID);
            button2.appendChild(a2);
            newList.appendChild(button2);

            var button3 = document.createElement("li");
            var a3 = document.createElement("a");
            a3.type = "button";
            a3.textContent = "View/Edit Details?";
            a3.setAttribute("id", imgID);
            a3.addEventListener("click", function() {
              displayPopup(img, img.id, a3);
            });
            //a3.setAttribute("data-toggle", "modal");
            //a3.setAttribute("data-target", "#popupModal");
            button3.appendChild(a3);
            newList.appendChild(button3);

            var button4 = document.createElement("li");
            var a4 = document.createElement("a");
            a4.type = "button";
            a4.textContent = "Download";
            a4.setAttribute("id", imgID);
            button4.appendChild(a4);
            newList.appendChild(button4);

            var button5 = document.createElement("li");
            var a5 = document.createElement("a");
            a5.type = "button";
            a5.textContent = "Delete";
            a5.setAttribute("id", imgID);
            button5.appendChild(a5);
            newList.appendChild(button5);

            newDiv.appendChild(newList);
            document.getElementById("images").prepend(newDiv); // prepend - insert newDiv to the beginning of "images"
          };
          reader.readAsDataURL(input.files[i]);
        }
      }
    </script>
    <script>
      function displayModal(photoID, element) {
        var modal = document.getElementById("myModal");
        var modalImg = document.getElementById("img01");

        element.setAttribute("data-toggle", "modal");
        element.setAttribute("data-target", "#myModal");

        // Get the image and insert it inside the modal
        var img = document.getElementById(photoID);

        //modal.style.display = "block";
        modalImg.src = img.src;

        // // Get the <span> element that closes the modal
        // var span = document.getElementsByClassName("close")[0];

        // // When the user clicks on <span> (x), close the modal
        // span.onclick = function() {
        //   modal.style.display = "none";
        // };
      }

      function calculateFlash(num) {
          var binNum = (num >>> 0).toString(2);
          return binNum;
      }

      function displayPopup(img, photoID, element) {
        var exifObj = piexif.load(img.src);

        element.setAttribute("data-toggle", "modal");
        element.setAttribute("data-target", "#popupModal");

        var modalImg = document.getElementById("imgPopup");
        var modalDate = document.getElementById("modalDate");
        var modalDevice = document.getElementById("modalDevice");
        var modalIso = document.getElementById("modalIso");
        var modalExposure = document.getElementById("modalExposure");
        var modalGPS = document.getElementById("modalGPS");
        var modalModel = document.getElementById("modalModel");
        var modalFleshFired = document.getElementById("modalFleshFired");
        var modalFleshType = document.getElementById("modalFleshType");
        //var modalTitle = document.getElementById("modalTitle");

        // Get the image and insert it inside the modal
        var img = document.getElementById(photoID);
        modalImg.src = img.src;

        var id = img.id.substring(6)-1; //Image index in arrEXIF

        console.log(arrImages);

        modalTitle.innerHTML = arrImages[id].name;

        modalDate.value = arrEXIF[id]["0th"]["306"];
        modalModel.value = arrEXIF[id]["0th"]["271"];
        modalDevice.value = arrEXIF[id]["0th"]["272"];
        modalIso.value = arrEXIF[id]["Exif"]["34855"];
        modalExposure.value = (arrEXIF[id]["Exif"]["33434"]).toString().replace(",","/");

        var flashVal = calculateFlash(arrEXIF[id]["Exif"]["37385"]);

        // Check last bit if flash fired
        if (flashVal.substr(flashVal.length - 1) == 1)
        {
            modalFleshFired.value = 1;
        }
        else
        {
            modalFleshFired.value = 2;
        }

        // Check flash type
        if (flashVal.substr(flashVal.length - 5, flashVal.length - 3) == 11) 
        {
            modalFleshType.value = 1; // auto
        }
        else if (flashVal.substr(flashVal.length - 5, flashVal.length - 3) == 01)
        {
            modalFleshType.value = 2; // compulsory flash firing
        }
        else if (flashVal.substr(flashVal.length - 5, flashVal.length - 3) == 10)
        {
            modalFleshType.value = 3; // compulsory flash suppression
        }
        
        // ----------------- GPS

        var latitude = arrEXIF[id]["GPS"]["2"];
        var latitudeArray = latitude.toString().split(",");
        // e.g if data in latitudeArray is 55,1,36,1,2554,100 it equals 55° 36' 25.5"
        console.log(latitudeArray[0]);

        //'Date: ' + arrEXIF[id]["0th"]["306"] + '\n Title: ' + arrEXIF[id]["0th"]["2"] + '\n Model: ' + arrEXIF[id]["0th"]["272"];
        //modalInfo.innerHTML = 'Date: ' + exifObj["0th"]["306"] + '\n Title: ' + exifObj["0th"]["2"] + '\n Model: ' + exifObj["0th"]["272"];        
      }

    </script>
  </body>
</html>