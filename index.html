<!DOCTYPE html>
<html>

<head>
    <title>Image Metadata Viewer</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />

    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <link rel="stylesheet" type="text/css" href="css/sideNavBar.css" />
    <link rel="stylesheet" type="text/css" href="css/topNavBar.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<body style="background-image: url(img/background.png);">
    <!-- LEFT PART -->
    <!-- Side naviagtion bar  -->
    <div class="sideNavBar">
        <!--LOGO-->
        <div id="logo" align="center">
            <img id="logo" src="img/logo.png" />
        </div>

        <!-- Buttons section -->
        <div class="container buttonsSideBar" align="center">
            <!--UPLOAD BUTTON-->
            <label class="btn btn-primary btn-responsive uploadButton" for="photos" align="center">Upload JPEG
                photo</label>
            <input type="file" id="photos" multiple="multiple" id="file-input" onchange="readURL(this);"
                accept="image/jpeg" display="none" />

            <div>
                <h5 style="font-size: 0.8vw">Upload a local file (only JPEG) to read Exif data.</h5>
            </div>

            <!-- Filter section -->
            <div>
                <h4 align="left" style="font-size: 1.2vw">Filter by: </h4>
            </div>
            <div class="row button-row sideGroup">
                <div class="col-xs button-container sideGroup">
                    <div class="btn-group sideGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> One - 1 </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox1"
                                        value="option1">
                                    <label class="form-check-label" for="inlineCheckbox1">First</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox2"
                                        value="option2">
                                    <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox3"
                                        value="option3">
                                    <label class="form-check-label" for="inlineCheckbox3">Third</label>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row button-row sideGroup">
                <div class="col-xs button-container sideGroup">
                    <div class="btn-group sideGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> Two - 2 </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox1"
                                        value="option1">
                                    <label class="form-check-label" for="inlineCheckbox1">First</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox2"
                                        value="option2">
                                    <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox3"
                                        value="option3">
                                    <label class="form-check-label" for="inlineCheckbox3">Third</label>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row button-row sideGroup">
                <div class="col-xs button-container sideGroup">
                    <div class="btn-group sideGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> Three - 3 </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox1"
                                        value="option1">
                                    <label class="form-check-label" for="inlineCheckbox1">First</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox2"
                                        value="option2">
                                    <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox3"
                                        value="option3">
                                    <label class="form-check-label" for="inlineCheckbox3">Third</label>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row button-row sideGroup">
                <div class="col-xs button-container sideGroup">
                    <div class="btn-group sideGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> Four - 4 </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox1"
                                        value="option1">
                                    <label class="form-check-label" for="inlineCheckbox1">First</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox2"
                                        value="option2">
                                    <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox3"
                                        value="option3">
                                    <label class="form-check-label" for="inlineCheckbox3">Third</label>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row button-row sideGroup">
                <div class="col-xs button-container sideGroup">
                    <div class="btn-group sideGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> Five - 5 </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox1"
                                        value="option1">
                                    <label class="form-check-label" for="inlineCheckbox1">First</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox2"
                                        value="option2">
                                    <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox3"
                                        value="option3">
                                    <label class="form-check-label" for="inlineCheckbox3">Third</label>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row button-row sideGroup">
                <div class="col-xs button-container sideGroup">
                    <div class="btn-group sideGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> Six - 6 </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox1"
                                        value="option1">
                                    <label class="form-check-label" for="inlineCheckbox1">First</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox2"
                                        value="option2">
                                    <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row button-row sideGroup">
                <div class="col-xs button-container sideGroup">
                    <div class="btn-group sideGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> Seven - 7 </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox1"
                                        value="option1">
                                    <label class="form-check-label" for="inlineCheckbox1">First</label>
                                </div>
                            </a>
                            <a class="dropdown-item">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="inlineCheckbox2"
                                        value="option2">
                                    <label class="form-check-label" for="inlineCheckbox2">Second</label>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row button-row sideGroup">
                <div class="col-xs button-container sideGroup">
                    <div class="btn-group sideGroup">
                        <button type="button" class="btn btn-primary btn-responsive filterButton"> Filter </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--RIGHT PART-->
    <!-- Top navigation bar -->
    <div class="topNavBar">
        <div class="container buttonsTopBar">
            <h4 style="font-size: 1.2vw">Sort by: </h4>
            <div class="row button-row topGroup">
                <div class="col-xs button-container topGroup">
                    <div class="btn-group topGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> Name </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="sortImages('name','asc')"><span class="glyphicon glyphicon-sort-by-alphabet"></span> A - Z
                            </a>
                            <a class="dropdown-item" onclick="sortImages('name','desc')"><span class="glyphicon glyphicon-sort-by-alphabet-alt"></span> Z -A
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-xs button-container topGroup">
                    <div class="btn-group topGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> Date </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="sortImages('date','asc')">Oldest to Newest</a>
                            <a class="dropdown-item" onclick="sortImages('date','desc')">Newest to Oldest</a>
                        </div>
                    </div>
                </div>
                <div class="col-xs button-container topGroup">
                    <div class="btn-group topGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> Camera model </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item"><span class="glyphicon glyphicon-sort-by-alphabet"></span> A - Z
                            </a>
                            <a class="dropdown-item"><span class="glyphicon glyphicon-sort-by-alphabet-alt"></span> Z -A
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-xs button-container topGroup">
                    <div class="btn-group topGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> One </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item"> Link 1 </a>
                            <a class="dropdown-item"> Link 2 </a>
                        </div>
                    </div>
                </div>
                <div class="col-xs button-container topGroup">
                    <div class="btn-group topGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> Two </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item"> Link 1 </a>
                            <a class="dropdown-item"> Link 2 </a>
                        </div>
                    </div>
                </div>
                <div class="col-xs button-container topGroup">
                    <div class="btn-group topGroup">
                        <button type="button" class="btn btn-primary dropdown-toggle btn-responsive"
                            data-toggle="dropdown"> Three </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item"> Link 1 </a>
                            <a class="dropdown-item"> Link 2 </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!---UPLOADING ZONE-->
    <div class="images" id="images"></div>

    <!-- Zoom photo -->
    <div id="myModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01" />
        <div id="caption"></div>
    </div>

    <!-- Modal Detail-->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        Close
                    </button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="piexif.js"></script>
    <script>
        var arrImages = [];
        /* global variable storing exif data of every image */
        var arrEXIF = [];
        var imgID = 0;
        function readURL(input) {
            for (let i = 0; i < input.files.length; i++) {
                var reader = new FileReader();
                reader.onload = function(event) {
                    arrImages.push(input.files[i]);
                    var exifObj = piexif.load(event.target.result);
                    arrEXIF.push(exifObj);

                    /* EXAMPLE - wartości można zobaczyc w konsoli Fn + F12*/
                    console.log(exifObj["0th"]["306"]) // tak się czyta na przykład datę wykonania
                    console.log(arrEXIF[0]["0th"]["306"]) // a tak ze zmiennej globalnej
                    console.log(piexif.TAGS["0th"]["306"]["name"])
                    console.log(exifObj) // tutaj można podejrzeć jakie są numerki
                    for (var ifd in exifObj) { // Loop through the properties of an object
                        if (ifd == "thumbnail") {
                            continue; // ommit "thumbnail"
                        }
                        console.log("-" + ifd);
                        for (var tag in exifObj[ifd]) {
                            // a tu można podejrzeć co oznaczają dane numerki - jakie mają nazwy, np. DateTime to 306
                            console.log("  " + piexif.TAGS[ifd][tag]["name"] + ":" + exifObj[ifd][tag]);
                        }
                    }

                    var newDiv = document.createElement("div");
                    newDiv.className = "dropdown";

                    var img = document.createElement("img"); // create new image
                    img.src = event.target.result; // source = uploaded file
                    imgID++;
                    img.setAttribute("id", "photo_" + imgID);
                    img.addEventListener("click", function () {
                        displayModal(img.id);
                    });
                    newDiv.appendChild(img);

                    // rotation button 
                    var rButton = document.createElement("button");
                    rButton.className = "rButton";
                    rButton.innerHTML = " <span class='glyphicon glyphicon-repeat'></span>  "  ; 
                    rButton.setAttribute("id", imgID)
                    rButton.addEventListener("click", function () {
                        rotateImg(img.id);
                    });
                    newDiv.appendChild(rButton);

                    var xButton = document.createElement("button");
                    xButton.className = "xButton";
                    xButton.textContent = "X";
                    xButton.setAttribute("id", imgID)
                    xButton.addEventListener("click", function () {
                        deleteImg(img.id, xButton.id);
                    });
                    newDiv.appendChild(xButton);

                    var newList = document.createElement("ul"); // dropdown list
                    newList.className = "dropdown-content";

                    var button1 = document.createElement("li");
                    var a1 = document.createElement("a");
                    a1.type = "button";
                    a1.textContent = "View Photo";
                    a1.setAttribute("id", imgID);
                    a1.addEventListener("click", function () {
                        displayModal(img.id);
                    });
                    button1.appendChild(a1);
                    newList.appendChild(button1);

                    var button2 = document.createElement("li");
                    var a2 = document.createElement("a");
                    a2.type = "button";
                    a2.textContent = "Rename?";
                    a2.setAttribute("id", imgID);
                    button2.appendChild(a2);
                    newList.appendChild(button2);

                    var button3 = document.createElement("li");
                    var a3 = document.createElement("a");
                    a3.type = "button";
                    a3.textContent = "View/Edit Details?";
                    a3.setAttribute("id", imgID);
                    a3.setAttribute("data-toggle", "modal");
                    a3.setAttribute("data-target", "#exampleModalCenter");
                    button3.appendChild(a3);
                    newList.appendChild(button3);

                    //data-toggle="modal" data-target="#exampleModalCenter"

                    var button4 = document.createElement("li");
                    var a4 = document.createElement("a");
                    a4.type = "button";
                    a4.textContent = "Download";
                    a4.setAttribute("id", imgID);
                    button4.appendChild(a4);
                    newList.appendChild(button4);

                    newDiv.appendChild(newList);
                    document.getElementById("images").prepend(newDiv); // prepend - insert newDiv to the beginning of "images"
                };
                reader.readAsDataURL(input.files[i]);
            }
        }
    </script>
    <script>
        function displayModal(photoID) {
            var modal = document.getElementById("myModal");
            var modalImg = document.getElementById("img01");

            // Get the image and insert it inside the modal
            var img = document.getElementById(photoID);

            modal.style.display = "block";
            modalImg.src = img.src;

            // Get the <span> element that closes the modal
            var span = document.getElementsByClassName("close")[0];

            // When the user clicks on <span> (x), close the modal
            span.onclick = function () {
                modal.style.display = "none";
            };
        }
    </script>
    <script>
        function deleteImg(photoID, numID) {
            var img = document.getElementById(photoID);

            //Deleting from node
            let node = img.parentNode.parentNode;
            node.removeChild(img.parentNode);

            //Deleting from global variables
            arrEXIF.splice(numID, 1);
            arrImages.splice(numID, 1);

            //Changing ID
            imgID = 1;
            for (let i = node.childNodes.length - 1; i >= 0; --i) {           //from last added photo
                let divNode = node.childNodes[i];                           //get all "div" nodes
                for (let j = 0; j < divNode.childNodes.length; ++j) {
                    if (divNode.childNodes[j].id == "") {                       //if so - current node is a buttons list
                        let listNode = divNode.childNodes[j];               //get all "list-button" nodes
                        for (let k = 0; k < listNode.childNodes.length; ++k) {
                            listNode.childNodes[k].firstChild.id = imgID;   //change firstChild's id, cause "button" node has only one child
                        }
                    } else if (parseInt(divNode.childNodes[j].id)) {          //if so - current node is a "x"-button
                        divNode.childNodes[j].id = imgID;                   //change "x"-button id 
                    }
                    else {                                                   //if no - current node is an image
                        divNode.childNodes[j].id = "photo_" + imgID;        //change image's id
                    }
                }
                imgID++;
            }
        };

        function rotateImg(photoID) {
            var img = document.getElementById(photoID);

            if (img.style.transform == "") {
                img.style.transform = 'rotate(90deg)';
            }
            else if (img.style.transform == 'rotate(90deg)') {
                img.style.transform = 'rotate(180deg)';
            }
            else if (img.style.transform == 'rotate(180deg)') {
                img.style.transform = 'rotate(270deg)';
            }
            else if (img.style.transform == 'rotate(270deg)') {
                img.style.transform = 'rotate(0deg)';
            }
            else if (img.style.transform == 'rotate(0deg)') {
                img.style.transform = 'rotate(90deg)';
            }
        };

    </script>
    <script>
        function sortImages(sortBy,order) {
            var parentDiv = document.getElementById("images"); 
            /* get images */
            var parentDivImages = parentDiv.getElementsByTagName("img"); 
            /* copy images' ids and theirs names into a list */
            var parentDivImagesSorted = [];
            for(let i=0; i<parentDivImages.length; i++)
            {
            let ID = parentDivImages[i].id;
            switch (sortBy) {
                case "name":
                var obj = { "id": ID, "name": arrImages[ID.substring(6)-1].name};
                break;
                case "date":
                var obj = { "id": ID, "date": arrEXIF[ID.substring(6)-1]["0th"]["306"]};
                break;
                default:
                /* ? */
            }
            parentDivImagesSorted.push(obj);
            }
            /* sort with a desired order */
            parentDivImagesSorted.sort(compareValues(sortBy,order));
            for(let img in parentDivImagesSorted) 
            {
            let imgDiv = document.getElementById(parentDivImagesSorted[img].id).parentNode;
            /* change order of div elements */
            parentDiv.appendChild(imgDiv);
            }
        }
    
        function compareValues(key, order = 'asc') { //'asc' by default
            return function innerSort(a, b) {
            const varA = (typeof a[key] === 'string') // for 'string' change to upper case (comparison is not case sensitive)
                ? a[key].toUpperCase() : a[key];
            const varB = (typeof b[key] === 'string') 
                ? b[key].toUpperCase() : b[key];
    
            let comparison = 0;
            if (varA > varB) { // e.g. for strings S>P
                comparison = 1;
            } else if (varA < varB) {
                comparison = -1;
            }
            return (
                (order === 'desc') ? (comparison * -1) : comparison
            );
            };
        }
    </script>
</body>

</html>